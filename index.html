<html>
<script>
var host = location.origin.replace(/^http/, 'ws')
var ws = new WebSocket(host)
ws.onopen = function () {
  connected();
}
ws.onmessage = function (ev) {
  received(ev.data);
}
var send = function(message) {
  ws.send(message);
}

var received;
var connected;

if (window.$agent) {
  // For Jasonette Agents
  received = function(message) {
    if (typeof message !== "object") {  // ignore pings
      $agent.trigger("onmessage", message)
    }
  }
  connected = function() {
    $agent.trigger("onconnect")
  }
} else {
  // For regular web app
  received = function(message) {
    if (typeof message !== "object") {  // ignore pings
      var line = document.createElement("pre");
      line.innerHTML = message;
      document.querySelector("#messages").appendChild(line);
    }
  }
  connected = function() {
    var line = document.createElement("pre");
    line.innerHTML = "websocket connected ...";
    document.querySelector("#messages").appendChild(line);
  }
  document.addEventListener("DOMContentLoaded", function(e) {
    document.querySelector("#send").onclick = function(c) {
      send(document.querySelector("#message").value)
    }
  })
}


</script>
<input type='text' placeholder='enter message' id='message'>
<button id='send'>Send</button>
<div id='messages'></div>
</html>
