<html>
<script>
var host = location.origin.replace(/^http/, 'ws')
var ws = new WebSocket(host)
var received = function(message) {
  if (typeof message !== "object") {  // ignore pings
    if (window.$agent) {
      $agent.trigger("onmessage", message)
    } else {
      console.log("Message: ", message);
      document.write(message + "<br>");
    }
  }
}
var connected = function() {
  if (window.$agent) {
    $agent.trigger("onconnect")
  } else {
    console.log('websocket connected ...')
  }
}
ws.onopen = function () {
  connected();
}
ws.onmessage = function (ev) {
  received(ev.data);
}
var send = function(message) {
  ws.send(message);
}
</script>
</html>
